import { useState, useContext } from 'react'
import { NavLink } from 'react-router'
import { addNote } from '../../utils/db'
import NotesContext from '../../context/NotesContext'
import styles from './CreateNote.module.scss'

function CreateNote() {
    const { onSave, onOpenSave } = useContext(NotesContext)

    const [title, setTitle] = useState('')
    const [text, setText] = useState('')

    async function saveNote() {
        if (!text.trim()) return
    
        const note = ({
            title: title.trim(),
            content: text,
            createdAt: Date.now()
        })

        const id = await onSave(note)

        const finalTitle = title.trim() || `Заметка №${id}`
    
        onOpenSave(finalTitle)
        setTitle('')
        setText('')
    }

    return (
        <div className={styles.create}>
            <div className={styles.createButtons}>
                <div className={styles.createButtonsItems}>
                    <NavLink to="/">
                        <button>
                            <svg width="28" height="30" viewBox="0 0 28 30" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M5.17437 3.80345C2.32511 5.89336 0 7.62039 0 7.64055C0 7.68087 10.0934 15.1132 10.3353 15.2543C10.4428 15.3148 10.4495 14.9385 10.4495 7.65399C10.4495 3.44057 10.4294 -0.00678137 10.4025 -6.13949e-05C10.3689 -6.13949e-05 8.02364 1.70681 5.17437 3.80345Z" fill="white"/>
                                <path d="M12.5461 7.80186L12.5663 11.303L13.3055 11.4307C16.1279 11.9011 18.3656 12.9494 19.965 14.542C21.6114 16.175 22.4111 18.1238 22.4111 20.4892C22.4111 22.0684 22.0549 23.4258 21.188 25.1797L20.6975 26.1608V26.9C20.6975 27.572 20.7176 27.6863 20.8856 28.0424C20.9864 28.2642 21.1746 28.5666 21.3023 28.7212C21.5509 29.0303 22.989 30.0517 23.0898 29.998C23.1167 29.9778 23.4056 29.6149 23.7147 29.1983C25.4686 26.8732 26.6514 24.0373 27.0882 21.1276C27.236 20.1465 27.2562 17.7138 27.1218 16.6924C26.5774 12.4319 24.6219 9.20634 21.2687 7.02907C19.6492 5.98075 17.4248 5.11387 15.1804 4.67035C14.3404 4.50235 12.9359 4.29403 12.6671 4.29403C12.5327 4.29403 12.5327 4.34779 12.5461 7.80186Z" fill="white"/>
                            </svg>
                        </button>
                    </NavLink>
                </div>
                <div className={styles.createButtonsItems}>
                    <p>Микрофон: <span>выключен</span></p>
                    <button>
                        <svg width="17" height="20" viewBox="0 0 17 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M5.22668 0.0292606C4.63709 0.125435 3.9806 0.531038 3.60844 1.02027C3.3032 1.42587 3.14848 1.81893 3.06903 2.39179L3.04395 2.59251L4.35275 2.60087L5.66573 2.61341L5.67828 2.87685C5.70336 3.36608 5.49011 3.84277 5.1305 4.10202C4.84616 4.30691 4.62872 4.34873 3.79661 4.34873H3.05231V4.99685V5.64498H4.37365H5.69918L5.67828 6.02132C5.64064 6.64436 5.39812 7.03741 4.89216 7.2883C4.72072 7.37193 4.63291 7.3803 3.88024 7.39284L3.05231 7.40957V8.05351V8.69746H4.37365H5.69918L5.67828 9.06961C5.64064 9.69265 5.42321 10.0606 4.94234 10.2948L4.66636 10.4328L3.85933 10.4453L3.05231 10.462L3.06067 11.3234L3.07322 12.189L5.17232 12.2015L7.27142 12.2099L7.76483 11.7165C8.26661 11.2105 8.70148 10.8886 9.2618 10.6042L9.5545 10.4579L8.91056 10.4537H8.26661L8.28752 10.0773C8.32515 9.45431 8.56768 9.06125 9.07363 8.81454C9.24507 8.73091 9.33707 8.71837 10.0897 8.70582L10.9135 8.6891V8.04515V7.4012H9.59214H8.26661L8.28752 7.02487C8.30842 6.71126 8.33351 6.59836 8.44223 6.37674C8.59276 6.07568 8.7433 5.92932 9.07363 5.77461C9.29107 5.67007 9.34543 5.66589 10.1106 5.65335L10.9135 5.63662V4.99267V4.34873H9.59214H8.26661L8.28752 3.97657C8.32515 3.35772 8.57604 2.95629 9.06945 2.72213C9.29107 2.61759 9.34125 2.61341 10.1106 2.60087L10.9135 2.58414V1.29207V-9.53674e-06L8.12444 0.00417233C6.58566 0.00835323 5.28522 0.0208979 5.22668 0.0292606Z" fill="white"/>
                            <path d="M1.33807 6.58167C0.664855 6.76147 0.171441 7.2967 0.0418148 7.98246C0.0167259 8.12463 0 9.5756 0 11.9423V15.6806H2.40435H4.8087L4.80033 16.5461L4.78779 17.4159L4.11875 17.4368C3.4999 17.4577 3.43299 17.4702 3.21974 17.5706C2.63015 17.8591 2.32072 18.3023 2.19946 19.0132L2.17855 19.1512H4.72507C6.13004 19.1512 7.27577 19.1428 7.27577 19.1345C7.27577 19.1261 7.18796 18.9923 7.08342 18.8334C6.1844 17.4953 5.89588 15.8478 6.28894 14.3007L6.38093 13.9243H4.06858H1.75622V10.2237V6.52313L1.64332 6.52731C1.57642 6.52731 1.44261 6.5524 1.33807 6.58167Z" fill="white"/>
                            <path d="M12.21 8.27095V10.0188L12.6407 10.0857C12.8748 10.1233 13.2261 10.207 13.4226 10.2655C13.6191 10.3241 13.8198 10.3868 13.8742 10.3993L13.9662 10.4202V9.34141C13.9662 8.74346 13.9495 8.14969 13.9244 8.0117C13.8407 7.50156 13.5104 7.01232 13.0839 6.76144C12.8957 6.65272 12.4776 6.52309 12.3061 6.52309H12.21V8.27095Z" fill="white"/>
                            <path d="M10.9053 11.4154C9.02365 11.8127 7.62704 13.3682 7.44723 15.2666C7.24652 17.3866 8.61387 19.3351 10.6879 19.8913C11.0558 19.9875 11.1771 20 11.7709 20C12.3605 20 12.4901 19.9875 12.8455 19.8913C16.0653 19.0299 17.2068 15.1202 14.9446 12.7117C14.2881 12.0134 13.456 11.5576 12.5445 11.3903C12.1012 11.3109 11.3444 11.3234 10.9053 11.4154ZM12.3647 12.695C12.5445 12.7326 12.8079 12.8162 12.9584 12.8831L13.2302 13.0086L11.1729 15.0659C8.83967 17.3949 9.08637 17.2277 8.88566 16.6297C8.7184 16.1447 8.69331 15.4673 8.81876 14.9655C9.04874 14.0456 9.60488 13.3682 10.4746 12.9417C11.0851 12.6406 11.7123 12.5612 12.3647 12.695ZM14.5767 14.493C14.7355 14.8526 14.8025 15.1997 14.8025 15.6805C14.8025 16.2158 14.7272 16.5545 14.5097 16.9977C14.1209 17.8005 13.3891 18.3985 12.5026 18.6368C11.9298 18.7916 11.1018 18.7163 10.5373 18.457L10.3115 18.3525L12.3563 16.3078C13.4853 15.1788 14.4219 14.2588 14.4387 14.2588C14.4554 14.2588 14.5181 14.3634 14.5767 14.493Z" fill="white"/>
                        </svg>
                    </button>
                    <button className={!text.trim() ? styles.createButtonsItemsInactive : ''}>
                        <span>Установить пароль</span>                   
                        <svg width="17" height="20" viewBox="0 0 17 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M1.77109 9.02399C1.51474 9.1172 1.04867 9.49006 0.722417 9.83962C0.139823 10.4455 0.139823 10.5154 0.0699113 15.2228L0 20.0001L7.57372 19.9301L15.1708 19.8602L15.9165 19.0912L16.6855 18.3455L16.7554 13.5682L16.8253 8.79095L9.53124 8.81425C5.52299 8.81425 2.02743 8.90747 1.77109 9.02399ZM5.15013 13.4517C5.40647 13.708 5.61621 14.1275 5.61621 14.3839C5.61621 14.9898 4.82388 15.7821 4.21798 15.7821C3.61208 15.7821 2.81976 14.9898 2.81976 14.3839C2.81976 14.1275 3.02949 13.708 3.28583 13.4517C3.54217 13.1954 3.96164 12.9856 4.21798 12.9856C4.47432 12.9856 4.89379 13.1954 5.15013 13.4517ZM9.34481 13.4517C9.60115 13.708 9.81088 14.1275 9.81088 14.3839C9.81088 14.9898 9.01856 15.7821 8.41266 15.7821C7.80676 15.7821 7.01443 14.9898 7.01443 14.3839C7.01443 14.1275 7.22417 13.708 7.48051 13.4517C7.73685 13.1954 8.15632 12.9856 8.41266 12.9856C8.669 12.9856 9.08847 13.1954 9.34481 13.4517ZM13.5395 13.4517C13.7958 13.708 14.0056 14.1275 14.0056 14.3839C14.0056 14.9898 13.2132 15.7821 12.6073 15.7821C12.351 15.7821 11.9315 15.5723 11.6752 15.316C11.4188 15.0597 11.2091 14.6402 11.2091 14.3839C11.2091 14.1275 11.4188 13.708 11.6752 13.4517C11.9315 13.1954 12.351 12.9856 12.6073 12.9856C12.8637 12.9856 13.2831 13.1954 13.5395 13.4517Z" fill="white"/>
                            <path d="M6.78132 0.145168C5.12675 0.681155 3.70522 1.89295 2.9362 3.431C2.70316 3.87377 2.47012 4.94574 2.40021 5.80798L2.28369 7.39264H3.72852H5.15005V6.27406C5.15005 4.96905 5.75595 3.85047 6.82793 3.19796C8.99518 1.86965 11.6751 3.64073 11.6751 6.39058V7.39264H13.0966H14.5415L14.425 5.80798C14.2618 3.431 13.0966 1.61331 11.0925 0.58794C10.0905 0.0752568 7.73677 -0.181085 6.78132 0.145168Z" fill="white"/>
                        </svg>
                    </button>
                    <button onClick={saveNote} className={!text.trim() ? styles.createButtonsItemsInactive : ''}>
                        <span>Сохранить</span>
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M0 8.23333C0 13.2032 0.0212865 16.6586 0.0532163 16.9572C0.22883 18.605 1.43684 19.7941 3.10251 19.9541C3.44842 19.9914 6.61479 20.0074 11.814 19.9968L19.9827 19.9808L19.9987 11.7954C20.004 6.64425 19.9934 3.41278 19.9614 3.07683C19.8976 2.44227 19.7539 1.98901 19.4772 1.56241C19.1792 1.10382 18.9237 0.842529 18.4927 0.549244C17.8488 0.122646 17.588 0.0533237 16.4864 0.0213299L15.5392 0V3.33813V6.68158L10.6539 6.66559L5.77397 6.64959L5.41742 6.47362C4.99701 6.26565 4.73093 5.9777 4.5766 5.57243C4.47549 5.30047 4.47017 5.1565 4.47017 2.65024V0.010664H2.23509H0V8.23333ZM16.6567 13.5818V17.1812H10.0047H3.35263V14.579C3.35263 11.8061 3.36327 11.6568 3.62403 11.1449C3.76772 10.8622 4.2307 10.3983 4.51274 10.2543C5.04491 9.98238 4.8959 9.98771 10.9785 9.98771L16.6567 9.98238V13.5818Z" fill="white"/>
                            <path d="M11.1221 2.49025V4.96985H12.2396H13.3572V2.49025V0.010653H12.2396H11.1221V2.49025Z" fill="white"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div className={styles.createContainer}>
                <input name="nameNote" placeholder="Название заметки" onChange={(e) => setTitle(e.target.value)} />
            </div>
            <div className={`${styles.createContainer} ${styles.createContent}`}>
                <div contentEditable="true" data-placeholder="Текст" onInput={(e) => setText(e.currentTarget.innerHTML)}></div>
            </div>
        </div>
    )
}

export default CreateNote